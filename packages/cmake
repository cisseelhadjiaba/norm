#!/bin/bash

! is_without tests && depends_on file ## tests will not work without 'file' command

fetch_source http://www.cmake.org/files/v3.11/cmake-3.11.4.tar.gz 6bcf931844964fefc4ccfd7d025ba4ec2c7c2abb

do_unpack
## it's not cmake's job to test system-provided qt, we'll test qt when compiling qt
## also, nobody uses ccmake, avoid libncurses dependency
do_patch_inline -p0 << 'EOF'
--- CMakeLists.txt
+++ CMakeLists.txt
@@ -523,7 +523,7 @@
 
   #---------------------------------------------------------------------
   # Use curses?
-  if (UNIX)
+  if (0)
     # there is a bug in the Syllable libraries which makes linking ccmake fail, Alex
     if(NOT CMAKE_SYSTEM_NAME MATCHES syllable)
       set(CURSES_NEED_NCURSES TRUE)
EOF
do_compile -- -DCMAKE_SYSTEM_PREFIX_PATH="$PREFIX" -DCMake_TEST_Qt4=0 -DCMAKE_USE_OPENSSL=OFF
