#!/bin/bash

depends_on cmake
depends_on libaio
depends_on libjemalloc
depends_on libncurses

fetch_source https://downloads.mariadb.org/interstitial/mariadb-10.1.14/source/mariadb-10.1.14.tar.gz dcf46d638cd33032117a9f0d89e8650aa1309e74

do_unpack
pushd_src
cmake . -DCMAKE_INSTALL_PREFIX=\'"$PREFIX"\' -DBUILD_CONFIG=mysql_release -DCMAKE_BUILD_TYPE=Release -DCMAKE_SKIP_RPATH=ON -DCMAKE_C_FLAGS="-g -O2 $CPPFLAGS" -DCMAKE_CXX_FLAGS="-g -O2 $CPPFLAGS" -DCMAKE_EXE_LINKER_FLAGS="$LDFLAGS" -DCURSES_INCLUDE_PATH="$ESCAPED_PREFIX/include/ncurses"
do_make
! is_without tests && env - PATH="$PATH" make test
do_install
popd
