#!/bin/bash

depends_on cmake
depends_on libaio
depends_on libjemalloc

fetch_source https://downloads.mariadb.org/interstitial/mariadb-10.1.13/source/mariadb-10.1.13.tar.gz b89f92afedcb2de00f31f2ccec8aa1b4b17534b7

do_unpack
pushd_src
cmake . -DCMAKE_INSTALL_PREFIX=\'"$PREFIX"\' -DBUILD_CONFIG=mysql_release -DCMAKE_BUILD_TYPE=Release -DCMAKE_SKIP_RPATH=ON -DCMAKE_C_FLAGS="-g -O2 $CPPFLAGS" -DCMAKE_CXX_FLAGS="-g -O2 $CPPFLAGS" -DCMAKE_EXE_LINKER_FLAGS="$LDFLAGS"
do_make
! is_without tests && env - PATH="$PATH" make test
do_install
popd
