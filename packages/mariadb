#!/bin/bash

depends_on cmake
depends_on libaio
depends_on libjemalloc
depends_on libncurses
depends_on xz
depends_on bzip2
depends_on liblzo
depends_on libpcre
depends_on libreadline
depends_on libxml
depends_on bison
depends_on liblz4
depends_on libsnappy
depends_on zeromq
depends_on msgpack
depends_on libevent
depends_on openssl

fetch_source https://downloads.mariadb.org/interstitial/mariadb-10.1.17/source/mariadb-10.1.17.tar.gz 65d3bd1c253c3b1440dc9a628986257ffb92586f

do_unpack
pushd_src
cmake . -DCMAKE_INSTALL_PREFIX=\'"$PREFIX"\' -DBUILD_CONFIG=mysql_release -DCMAKE_BUILD_TYPE=Release -DCMAKE_SKIP_RPATH=ON -DCMAKE_C_FLAGS="-g -O2 $CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DCMAKE_CXX_FLAGS="-g -O2 $CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DCMAKE_EXE_LINKER_FLAGS="$LDFLAGS" -DCURSES_INCLUDE_PATH="$ESCAPED_PREFIX/include/ncurses" -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBEVENT=system -DWITH_JEMALLOC=system -DWITH_PCRE=system
do_make
! is_without tests && env - PATH="$PATH" make test
do_install
popd
