#!/bin/bash

depends_on cmake
depends_on libaio
depends_on libjemalloc
depends_on libncurses
depends_on xz
depends_on bzip2
depends_on liblzo
depends_on libreadline
depends_on libxml
needs_tool bison
depends_on liblz4
depends_on libsnappy
depends_on zeromq
depends_on msgpack
depends_on libevent
depends_on openssl
depends_on libcap
depends_on libpam

fetch_source https://downloads.mariadb.org/interstitial/mariadb-10.2.10/source/mariadb-10.2.10.tar.gz 14a7d6b5c77de5235b60ffa13bf80a1dd2dda49c

do_unpack
do_patch_inline -p0 << EOF
--- cmake/readline.cmake
+++ cmake/readline.cmake
@@ -230,6 +230,7 @@
     SET(CMAKE_REQUIRED_LIBRARIES)
     SET(CMAKE_REQUIRED_INCLUDES)
   ENDIF(NOT WIN32)
-  CHECK_INCLUDE_FILES ("curses.h;term.h" HAVE_TERM_H)
+  CHECK_INCLUDE_FILES ("curses.h" HAVE_CURSES_H)
+  CHECK_INCLUDE_FILES ("term.h" HAVE_TERM_H)
 ENDMACRO()
 
EOF
do_compile -DBUILD_CONFIG=mysql_release -DCURSES_INCLUDE_PATH="$ESCAPED_PREFIX/include/ncurses" -DCMAKE_C_FLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DCMAKE_CXX_FLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBEVENT=system -DWITH_JEMALLOC=system
