#!/bin/bash

needs_tool cmake
depends_on libaio
depends_on libncurses
depends_on openssl
depends_on libjemalloc
needs_tool bison
depends_on zlib

fetch_source https://downloads.mariadb.org/interstitial/mariadb-10.3.9/source/mariadb-10.3.9.tar.gz 51e9870847daa76f1e82ade97d9cf60a31df7656

do_unpack
do_patch_inline -p0 << EOF
--- cmake/readline.cmake
+++ cmake/readline.cmake
@@ -230,6 +230,7 @@
     SET(CMAKE_REQUIRED_LIBRARIES)
     SET(CMAKE_REQUIRED_INCLUDES)
   ENDIF(NOT WIN32)
-  CHECK_INCLUDE_FILES ("curses.h;term.h" HAVE_TERM_H)
+  CHECK_INCLUDE_FILES ("curses.h" HAVE_CURSES_H)
+  CHECK_INCLUDE_FILES ("term.h" HAVE_TERM_H)
 ENDMACRO()
 
EOF
do_compile -DBUILD_CONFIG=mysql_release -DCURSES_INCLUDE_PATH="$ESCAPED_PREFIX/include/ncurses" -DCMAKE_C_FLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DCMAKE_CXX_FLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncurses" -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBEVENT=system -DWITH_JEMALLOC=system
