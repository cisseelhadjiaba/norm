#!/bin/bash

depends_on zlib
depends_on openssl

fetch_source http://mirror.yandex.ru/pub/OpenBSD/OpenSSH/portable/openssh-7.2p2.tar.gz 70e35d7d6386fe08abbd823b3a12a3ca44ac6d38

## this file breaks reinstallation/upgrade
rm -f $PREFIX/share/man/man5/authorized_keys.5

do_unpack
do_compile --with-privsep-path=$PREFIX/var/empty --without-kerberos5 --sysconfdir=$PREFIX/etc/ssh \
           --with-pid-dir=$PREFIX/var/run  --with-mantype=doc --with-ssl-engine \
           --with-ldflags="-Wl,--as-needed $LDFLAGS"

## we disabled kerberos5, so remove the config values as well
sed -i 's/^[^#][ \t]*GSSAPI.*/#&/' $PREFIX/etc/ssh/ssh_config
