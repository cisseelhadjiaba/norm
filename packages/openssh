#!/bin/bash

depends_on zlib
depends_on openssl

fetch_source https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.8p1.tar.gz 27e267e370315561de96577fccae563bc2c37a60

## this file breaks reinstallation/upgrade
rm -f $PREFIX/share/man/man5/authorized_keys.5

do_unpack
# tests require root
do_compile_notest --with-privsep-path=$PREFIX/var/empty --without-kerberos5 --sysconfdir=$PREFIX/etc/ssh \
           --with-pid-dir=$PREFIX/var/run  --with-mantype=doc --with-ssl-engine

## we disabled kerberos5, so remove the config values as well
sed -ibak 's/^[^#][ \t]*GSSAPI.*/#&/' $PREFIX/etc/ssh/ssh_config
