#!/bin/bash

depends_on pkg-config # otherwise it won't install .pc files

fetch_source http://http.debian.net/debian/pool/main/n/ncurses/ncurses_6.0+20161126.orig.tar.gz 868589e7acb3a6cef5aa2827be8eb49aa4f1917b
fetch_debian http://http.debian.net/debian/pool/main/n/ncurses/ncurses_6.0+20161126-1.debian.tar.xz 9bb9b5520d775592fcff2018bef5eb46c9f4eb99

CONFOPTS=(
--enable-pc-files
--disable-termcap
--enable-rpath
--enable-const
--enable-symlinks
--without-ada
--without-cxx-binding
--with-shared
--without-debug
--with-pkg-config-libdir="$PREFIX/lib/pkgconfig"
)

[[ $OSTYPE == *linux* ]] && CONFOPTS+=(--with-termlib) ## tinfo.pc from system if present will make things more difficult

do_undebian_compile "${CONFOPTS[@]}"
do_undebian_compile "${CONFOPTS[@]}" --enable-widec
# link tinfo when linking ncurses
# lame, for example, doesn't link tinfo explicitly when linking ncurses
if [[ $OSTYPE != *darwin* ]]; then
    rm $PREFIX/lib/libncurses{,w}.so
    echo "INPUT(libncurses.so.6 -ltinfo)" > $PREFIX/lib/libncurses.so
    echo "INPUT(libncursesw.so.6 -ltinfow)" > $PREFIX/lib/libncursesw.so
    echo -e "/* We use a linker script rather than a symlink to work around\n   an ldconfig bug, see http://bugs.debian.org/249122. */\nGROUP( libtinfo.so )" > $PREFIX/lib/libtermcap.so
    # alias termcap into tinfo -- libedit for example looks for it everywhere but tinfo
    ln -fs libtinfo.a $PREFIX/lib/libtermcap.a
    ln -fs libncurses.a $PREFIX/lib/libcurses.a
    ln -fs libncurses.so $PREFIX/lib/libcurses.so
fi
