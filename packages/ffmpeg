#!/bin/bash

needs_tool pkg-config
needs_tool nasm

## ffmpeg is much more useful with these libraries
depends_on libopus
depends_on speex
depends_on libwebp
depends_on x264
depends_on x265
depends_on libvorbis
depends_on libxvid
depends_on libtheora
depends_on lame
[[ $OSTYPE == *linux* ]] && depends_on libasound
depends_on rtmpdump
depends_on libsdl2
depends_on libfdk-aac
depends_on libvpx
depends_on libaom
depends_on libopenjpeg

fetch_source http://www.ffmpeg.org/releases/ffmpeg-4.0.tar.xz 1f85916c154a4d6a342d7ec1f909bbc58a92c19d

CONFIGURE=(
--enable-pthreads
--enable-gpl
--enable-version3
--enable-shared
--enable-hardcoded-tables
--enable-avresample
--enable-nonfree
--enable-libx264
--enable-libx265
--enable-libmp3lame
--enable-libxvid
--enable-libtheora
--enable-libvorbis
--enable-sdl2
--enable-libaom
--enable-libspeex
--enable-libopus
--enable-librtmp
--enable-libfdk-aac
--enable-libwebp
--enable-libvpx
--enable-libopenjpeg
--enable-lto
)

[[ $OSTYPE == *darwin* ]] && CONFIGURE+=(--enable-videotoolbox --enable-audiotoolbox)

do_unpack
NEEDV1=1 do_compile "${CONFIGURE[@]}"
