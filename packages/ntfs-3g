#!/bin/bash

needs_tool autoconf automake libtool
depends_on libgcrypt
needs_tool pkg-config ## for autoconf macros

fetch_source http://jp-andre.pagesperso-orange.fr/ntfs-3g_ntfsprogs-2016.2.22AR.3.tgz edff6ff6e3fcaf75745edb5decb0f9e62154af15

do_unpack
do_patch_inline -p1 << 'EOF'
--- a/ntfsprogs/Makefile.am
+++ b/ntfsprogs/Makefile.am
@@ -166,14 +166,14 @@
 if ENABLE_MOUNT_HELPER
 install-exec-hook:
 	$(INSTALL) -d $(DESTDIR)/sbin
-	$(LN_S) -f $(sbindir)/mkntfs $(DESTDIR)/sbin/mkfs.ntfs
+	$(LN_S) -f mkntfs $(DESTDIR)$(sbindir)/mkfs.ntfs
 
 install-data-hook:
 	$(INSTALL) -d $(DESTDIR)$(man8dir)
 	$(LN_S) -f mkntfs.8 $(DESTDIR)$(man8dir)/mkfs.ntfs.8
 
 uninstall-local:
-	$(RM) -f $(DESTDIR)/sbin/mkfs.ntfs
+	$(RM) -f $(DESTDIR)$(sbindir)/mkfs.ntfs
 	$(RM) -f $(DESTDIR)$(man8dir)/mkfs.ntfs.8
 endif
 
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -67,8 +67,8 @@
 if ENABLE_MOUNT_HELPER
 install-exec-local:	install-rootbinPROGRAMS
 	$(MKDIR_P) "$(DESTDIR)/sbin"
-	$(LN_S) -f "$(rootbindir)/ntfs-3g" "$(DESTDIR)/sbin/mount.ntfs-3g"
-	$(LN_S) -f "$(rootbindir)/lowntfs-3g" "$(DESTDIR)/sbin/mount.lowntfs-3g"
+	$(LN_S) -f "$(rootbindir)/ntfs-3g" "$(DESTDIR)$(sbindir)/mount.ntfs-3g"
+	$(LN_S) -f "$(rootbindir)/lowntfs-3g" "$(DESTDIR)$(sbindir)/mount.lowntfs-3g"
 
 install-data-local:	install-man8
 	$(LN_S) -f ntfs-3g.8 "$(DESTDIR)$(man8dir)/mount.ntfs-3g.8"
@@ -76,7 +76,7 @@
 
 uninstall-local:
 	$(RM) -f "$(DESTDIR)$(man8dir)/mount.ntfs-3g.8"
-	$(RM) -f "$(DESTDIR)/sbin/mount.ntfs-3g" "$(DESTDIR)/sbin/mount.lowntfs-3g"
+	$(RM) -f "$(DESTDIR)$(sbindir)/mount.ntfs-3g" "$(DESTDIR)$(sbindir)/mount.lowntfs-3g"
 endif
 
 endif # ENABLE_NTFS_3G
EOF
do_autoreconf
do_compile --exec-prefix="$ESCAPED_PREFIX" --enable-extras --enable-xattr-mappings --enable-quarantined --disable-ldconfig --with-fuse=internal --enable-posix-acls --without-uuid
