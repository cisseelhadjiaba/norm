#!/bin/bash

depends_on zlib ## for transparent decompression of gzip/deflate encoded responses
[[ $OSTYPE != *darwin* ]] && depends_on openssl

fetch_source http://curl.mirror.anstey.ca/curl-7.61.0.tar.gz 34c0f89e01c27070fe3b6f86371791390f464602

CONFIGURE=(
--disable-ldap
--enable-optimize
--without-libssh2
--without-librtmp
--without-libpsl
--without-nghttp2
--without-libidn2
)

[[ $OSTYPE != *darwin* ]] && CONFIGURE+=("--with-ca-bundle=$PREFIX/etc/ssl/cert.pem")
[[ $OSTYPE == *darwin* ]] && CONFIGURE+=(--with-darwinssl --without-ca-bundle --with-default-ssl-backend=darwinssl --without-ssl)

do_unpack
sed -i.bak "s|mmacosx-version-min=10.8|mmacosx-version-min=$NORM_OSX_VERSION|" "$SRCDIR"/configure
do_compile "${CONFIGURE[@]}"
