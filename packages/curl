#!/bin/bash

[[ $OSTYPE != *darwin* ]] && depends_on openssl
depends_on zlib
depends_on libnghttp2
depends_on libidn2 ## opportunistic linking

fetch_source http://curl.mirror.anstey.ca/curl-7.58.0.tar.gz 089f17884d672aca7a661a65d847135f2f0ccbbf

CONFIGURE=(
--disable-ldap
--enable-optimize
--without-libssh2
--without-librtmp
--without-libpsl
)

[[ $OSTYPE != *darwin* ]] && CONFIGURE+=("--with-ca-bundle=$PREFIX/etc/ssl/cert.pem")
[[ $OSTYPE == *darwin* ]] && CONFIGURE+=(--with-darwinssl --without-ca-bundle --with-default-ssl-backend=darwinssl --without-ssl)

do_unpack
sed -i.bak "s|mmacosx-version-min=10.8|mmacosx-version-min=$NORM_OSX_VERSION|" "$SRCDIR"/configure
do_compile "${CONFIGURE[@]}"
