#!/bin/bash

depends_on openssl
depends_on libpcre
depends_on zlib

fetch_source https://www.haproxy.org/download/1.7/src/haproxy-1.7.9.tar.gz 1e0b7ca33c3cf3fcf6302c64509fe3308552a9f2

do_unpack
pushd_src
export TARGET=generic
[[ $OSTYPE == *linux* ]] && TARGET=linux2628
[[ $OSTYPE == *darwin* ]] && TARGET=osx
do_make TARGET=$TARGET USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1
mkdir -p "$PREFIX/bin"
install -m755 haproxy "$PREFIX/bin/"
mkdir -p "$PREFIX/share/man/man1"
install -m644 doc/haproxy.1 "$PREFIX/share/man/man1/"
popd_src
