#!/bin/bash

fetch_source http://http.debian.net/debian/pool/main/b/bzip2/bzip2_1.0.6.orig.tar.bz2 3725a0554fa6bb654ef2728fef36bc06aed4e388
fetch_debian http://http.debian.net/debian/pool/main/b/bzip2/bzip2_1.0.6-7.debian.tar.bz2 e5169afbee8f9ee603c253e03421364819a14c12

## these files break reinstall/upgrade
rm -f $PREFIX/bin/{bunzip2,bzcat}

do_undebian
pushd_src
sed -i 's/^CFLAGS=/CFLAGS=-fpic -fPIC /' Makefile
do_make
do_make test
do_install PREFIX=$PREFIX

## shared library needs to be built and installed manually
do_make -f Makefile-libbz2_so clean
do_make -f Makefile-libbz2_so
install -d $PREFIX/lib
install -m 755 libbz2.so.* $PREFIX/lib
cp -fd libbz2.so.1.0 $PREFIX/lib/
ln -fs libbz2.so.1.0 $PREFIX/lib/libbz2.so.1

popd
