#!/bin/bash

WITHOUT_PYTHON=--without-python
OURNAME=`basename "${BASH_SOURCE[0]}"`
[[ $OURNAME == python-libxml ]] && depends_on python && WITHOUT_PYTHON="--with-python=$PREFIX/bin/python"

depends_on autoconf automake libtool
depends_on zlib
depends_on xz
depends_on pkg-config

fetch_source http://xmlsoft.org/sources/libxml2-2.9.4.tar.gz 958ae70baf186263a4bd801a81dd5d682aedd1db
fetch_debian http://http.debian.net/debian/pool/main/libx/libxml2/libxml2_2.9.4+dfsg1-2.1.debian.tar.xz a87cdd246581b9c16e76d85f370ce940261570c8

do_undebian
pushd_src
rm -f test/errors/name2.xml # broken
do_patch_inline -p0 << 'EOF'
--- python/Makefile.am
+++ python/Makefile.am
@@ -19,7 +19,7 @@
 AM_CPPFLAGS = \
 	-I$(top_builddir)/include \
 	-I$(top_srcdir)/include	\
-	$(PYTHON_INCLUDES)
+	-I$(PYTHON_INCLUDES)
 
 python_LTLIBRARIES = libxml2mod.la
 
EOF
do_autoreconf
CPPFLAGS="$CPPFLAGS -DXML_XML_DEFAULT_CATALOG=\\\"file:///$ESCAPED_PREFIX/etc/xml/catalog\\\"" \
do_configure --with-zlib=$PREFIX $WITHOUT_PYTHON
do_make
do_test
do_install
popd_src
