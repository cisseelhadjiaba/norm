#!/bin/bash

depends_on cmake

fetch_source https://libsdl.org/release/SDL2-2.0.5.tar.gz c4f87580630387796df4ac87c362b4f9a721457e

do_unpack
do_patch_inline -p0 << EOF
--- src/audio/coreaudio/SDL_coreaudio.h
+++ src/audio/coreaudio/SDL_coreaudio.h
@@ -29,6 +29,12 @@
 #define MACOSX_COREAUDIO 1
 #endif
 
+#include <sys/_types.h>
+#ifndef _UUID_STRING_T
+#define _UUID_STRING_T
+typedef __darwin_uuid_string_t  uuid_string_t;
+#endif /* _UUID_STRING_T */
+
 #if MACOSX_COREAUDIO
 #include <CoreAudio/CoreAudio.h>
 #include <CoreServices/CoreServices.h>
--- src/file/cocoa/SDL_rwopsbundlesupport.m
+++ src/file/cocoa/SDL_rwopsbundlesupport.m
@@ -21,6 +21,11 @@
 #include "../../SDL_internal.h"
 
 #ifdef __APPLE__
+#include <sys/_types.h>
+#ifndef _UUID_STRING_T
+#define _UUID_STRING_T
+typedef __darwin_uuid_string_t  uuid_string_t;
+#endif /* _UUID_STRING_T */
 #import <Foundation/Foundation.h>
 
 #include "SDL_rwopsbundlesupport.h"
--- src/filesystem/cocoa/SDL_sysfilesystem.m
+++ src/filesystem/cocoa/SDL_sysfilesystem.m
@@ -25,6 +25,12 @@
 /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 /* System dependent filesystem routines                                */
 
+#include <sys/_types.h>
+#ifndef _UUID_STRING_T
+#define _UUID_STRING_T
+typedef __darwin_uuid_string_t  uuid_string_t;
+#endif /* _UUID_STRING_T */
+
 #include <Foundation/Foundation.h>
 #include <sys/stat.h>
 #include <sys/types.h>
--- src/video/cocoa/SDL_cocoavideo.h
+++ src/video/cocoa/SDL_cocoavideo.h
@@ -25,6 +25,12 @@
 
 #include "SDL_opengl.h"
 
+#include <sys/_types.h>
+#ifndef _UUID_STRING_T
+#define _UUID_STRING_T
+typedef __darwin_uuid_string_t  uuid_string_t;
+#endif /* _UUID_STRING_T */
+
 #include <ApplicationServices/ApplicationServices.h>
 #include <IOKit/pwr_mgt/IOPMLib.h>
 #include <Cocoa/Cocoa.h>
EOF
rm -vf "$SRCDIR"/configure
LDFLAGS="$LDFLAGS -framework QuartzCore" \
do_compile_outside
