#!/bin/bash

needs_tool pkg-config ## to find openssl
needs_tool cmake
depends_on libaio
depends_on libncurses
depends_on openssl

fetch_source http://cdn.mysql.com/Downloads/MySQL-8.0/mysql-boost-8.0.12.tar.gz c144d6c1350a9897da31ebbd3b5492ab1f152352

CONFOPTS=(
-DWITH_BOOST=boost
-DCURSES_INCLUDE_PATH="$ESCAPED_PREFIX/include/ncurses"
-DENABLE_DOWNLOADS=1
-DBUILD_CONFIG=mysql_release
-DFEATURE_SET=community
-DWITH_EXTRA_CHARSETS=all
-DWITH_SSL="system"
-DWITH_NUMA=OFF
)

## tests are broken as of 5.7.17, disable
do_unpack
sed -i.bak 's|ADD_SUBDIRECTORY(authentication_ldap)||' "$SRCDIR"/libmysql/CMakeLists.txt
do_compile_notest "${CONFOPTS[@]}"
