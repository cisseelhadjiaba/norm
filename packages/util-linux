#!/bin/bash

[[ $OSTYPE == *darwin* && $OURNAME == libuuid ]] && log "libuuid on OSX conflicts with system-provided uuid/uuid.h, bailing out" && exit 64

CONFFLAGS=(
--with-bashcompletiondir=$PREFIX/share/bash-completion/completions
--disable-makeinstall-chown
--without-systemd
--without-cap-ng
--without-udev
--without-tinfo
--without-libz
--without-ncursesw
--without-ncurses
--without-readline
--without-audit
--without-cap-ng
--without-python
--disable-chfn-chsh ## useless when rootless
--disable-su ## useless when rootless
--disable-login ## useless when rootless
--disable-runuser ## useless when rootless
)

OURNAME=`basename "${BASH_SOURCE[0]}"`
[[ $OURNAME == lib* ]] && CONFFLAGS+=(--without-python --without-ncurses --disable-all-programs --enable-$OURNAME)
[[ $OURNAME == libmount ]] && CONFFLAGS+=(--enable-libblkid)

fetch_source https://www.kernel.org/pub/linux/utils/util-linux/v2.32/util-linux-2.32.1.tar.xz de9271fb93fb651d21c027e2efb0cf0ac80f2e9a

CFLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncursesw -O2 -g" \
do_unpack_compile "${CONFFLAGS[@]}"
