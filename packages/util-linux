#!/bin/bash

[[ $OSTYPE == *darwin* && $OURNAME == libuuid ]] && log "libuuid on OSX conflicts with system-provided uuid/uuid.h, bailing out" && exit 64

depends_on pkg-config

unset EXTRAOPTIONS

OURNAME=`basename "${BASH_SOURCE[0]}"`
[[ $OURNAME != lib* ]] && needs_tool python && depends_on libncurses
[[ $OURNAME == lib* ]] && EXTRAOPTIONS+=" --without-python --without-ncurses --disable-all-programs --enable-$OURNAME"
[[ $OURNAME == libmount ]] && EXTRAOPTIONS+=" --enable-libblkid"

fetch_source https://www.kernel.org/pub/linux/utils/util-linux/v2.32/util-linux-2.32.tar.xz 4a21387d51f73bab44230c3bf9fe5a291e761111

CFLAGS="$CPPFLAGS -I$ESCAPED_PREFIX/include/ncursesw -O2 -g" \
do_unpack_compile $EXTRAOPTIONS --with-bashcompletiondir=$PREFIX/share/bash-completion/completions --disable-use-tty-group
