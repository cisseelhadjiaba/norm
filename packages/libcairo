#!/bin/bash

needs_tool pkg-config
depends_on libx11
depends_on libpng
depends_on pixman
depends_on libxext ## not checked by configure but required if xlib is enabled
depends_on fontconfig ## pangocairo won't build without font backend available through libcairo, needed by libcairomm and libpango
depends_on libxrender ## opportunistic linking
depends_on libpoppler ## opportunistic linking
depends_on liblzo ## opportunistic linking

unset EXTRALD
cc_addflags EXTRALD -Wl,--no-gc-sections

fetch_source http://cairographics.org/releases/cairo-1.14.10.tar.xz 28c59d85d6b790c21b8b59ece73a6a1dda28d69a

CONFFLAGS=(
--enable-xlib ## needed by libgtk2
)

## TODO: figure out why almost all libcairo tests fail spectacularly
LDFLAGS="$LDFLAGS $EXTRALD" \
do_unpack_compile_notest "${CONFFLAGS[@]}"
