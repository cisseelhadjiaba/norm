#!/bin/bash

depends_on pkg-config
depends_on autoconf automake libtool
depends_on lua
depends_on libdbus
depends_on libogg
depends_on libvorbis
depends_on libmad
depends_on liba52
depends_on libgcrypt
depends_on libva
depends_on libgstreamer-plugins-base
depends_on flac
depends_on x264
depends_on x265
depends_on ffmpeg

fetch_source http://get.videolan.org/vlc/3.0.0/vlc-3.0.0.tar.xz 50610841b060321242793cf6ad3d58759dc5973b

do_unpack
do_patch_inline << 'EOF' ## make it work with LUA 5.3 and libavutil >= 55
--- a/modules/lua/vlc.h
+++ b/modules/lua/vlc.h
@@ -39,6 +39,7 @@
 #include <vlc_demux.h>
 
 #define LUA_COMPAT_MODULE
+#define LUA_COMPAT_APIINTCASTS
 #include <lua.h>        /* Low level lua C API */
 #include <lauxlib.h>    /* Higher level C API */
 #include <lualib.h>     /* Lua libs */
EOF
do_autoreconf
do_compile --with-kde-solid="$PREFIX"/share/kde4/apps/solid/actions
