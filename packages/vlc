#!/bin/bash

needs_tool gettext ## otherwise fails to install ./vlc.appdata.xml
depends_on lua ## for lua libraries and headers
depends_on ffmpeg
depends_on liba52
depends_on libxcb

fetch_source http://get.videolan.org/vlc/3.0.3/vlc-3.0.3.tar.xz dd1b7350bb0a7848e172e9dbbe0705ec5bb3d48c

do_unpack
do_patch_inline << 'EOF' ## make it work with LUA 5.3 and libavutil >= 55
--- a/modules/lua/vlc.h
+++ b/modules/lua/vlc.h
@@ -39,6 +39,7 @@
 #include <vlc_demux.h>
 
 #define LUA_COMPAT_MODULE
+#define LUA_COMPAT_APIINTCASTS
 #include <lua.h>        /* Low level lua C API */
 #include <lauxlib.h>    /* Higher level C API */
 #include <lualib.h>     /* Lua libs */
EOF
do_compile --with-kde-solid="$PREFIX"/share/kde4/apps/solid/actions
