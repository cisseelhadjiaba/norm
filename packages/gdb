#!/bin/bash

depends_on zlib ## opportunistic linking, for zlib-compressed debug sections
depends_on xz   ## opportunistic linking, for lzma-compressed debug sections
depends_on libncurses ## opportunistic linking, no way to disable

fetch_source http://ftpmirror.gnu.org/gdb/gdb-8.1.tar.xz 641861f7d3f22b6a23bc3e801f0ff29a78375490

## gdb test suite is broken -- even their buildbot has failures that are ignored
## plus it needs python, rust, systemtap, gccgo and gfortran -- dependencies too heavy
do_unpack
sed -i.bak 's/^SUBDIRS = doc /SUBDIRS = /' "$SRCDIR"/gdb/Makefile.in
do_compile_notest --without-python --without-guile --enable-static --without-expat --without-babeltrace --without-mpfr --without-gmp
