#!/bin/bash

depends_on pkg-config
depends_on libslang glib
[[ $OSTYPE == *linux* ]] && depends_on libmount
depends_on libblkid
[[ $OSTYPE == *linux* ]] && depends_on libuuid
depends_on libssh2

fetch_source http://ftp.midnight-commander.org/mc-4.8.20.tar.xz 1e8b9840e65f276e6e67be7430750fde3b5909e4

do_unpack
do_patch_inline -p0 << EOF
--- src/filemanager/file.c
+++ src/filemanager/file.c
@@ -665,8 +665,13 @@
 get_times (const struct stat *sb, mc_timesbuf_t * times)
 {
 #ifdef HAVE_UTIMENSAT
+#ifdef __MACH__
+    (*times)[0] = sb->st_atimespec;
+    (*times)[1] = sb->st_mtimespec;
+#else // __MACH__
     (*times)[0] = sb->st_atim;
     (*times)[1] = sb->st_mtim;
+#endif // __MACH__
 #else
     times->actime = sb->st_atime;
     times->modtime = sb->st_mtime;
EOF
do_compile --without-x --with-screen=slang --without-gpm-mouse
