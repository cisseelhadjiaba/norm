#!/bin/bash

needs_tool pkg-config
needs_tool gperf ## for building QtWebEngine
needs_tool bison ## for building QtWebEngine
needs_tool flex ## for building QtWebEngine
needs_tool python ## Building QtQml requires Python
depends_on libdouble-conversion ## uses bundled one otherwise
depends_on libpcre2 ## uses bundled one otherwise
depends_on freetype ## uses bundled one othewrise
depends_on libjpeg ## uses bundled one otherwise
depends_on libpng ## uses bundled one otherwise
depends_on sqlite3 ## uses bundled one otherwise

fetch_source http://download.qt.io/official_releases/qt/5.11/5.11.0/single/qt-everywhere-src-5.11.0.tar.xz 0e69374a1b0b008e9c294b2f4aa5d337e628a183

CFLAGS="-g -O2 $CPPFLAGS" \
CXXFLAGS="-g -O2 $CPPFLAGS" \
do_unpack

CONFFLAGS=(
-prefix "$PREFIX"
-I $ESCAPED_PREFIX/include
-L $ESCAPED_PREFIX/lib
-R $ESCAPED_PREFIX/lib
-opensource
-confirm-license
-proprietary-codecs
-nomake examples
-no-compile-examples
-skip qtwayland
-no-opengl
-no-icu
)

is_without tests && CONFFLAGS+=(-nomake tests)

pushd_src
./configure "${CONFFLAGS[@]}"
do_make
! is_without tests && do_test
do_install
popd_src
