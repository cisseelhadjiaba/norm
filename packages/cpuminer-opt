#!/bin/bash

depends_on curl
depends_on openssl
depends_on libjansson

fetch_source https://github.com/hmage/cpuminer-opt/archive/master.tar.gz

unset EXTRAFLAGS
cc_addflags EXTRAFLAGS -Ofast -flto -fuse-linker-plugin -ftree-loop-if-convert-stores -DUSE_ASM

do_unpack
do_autoreconf
CFLAGS="$CPPFLAGS $EXTRAFLAGS" \
do_compile --with-crypto --with-curl
