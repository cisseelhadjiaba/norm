#!/bin/bash

needs_tool autoconf automake
needs_tool pkg-config ## for autoconf macros
needs_tool xmlto
needs_tool asciidoc
depends_on e2fsprogs
depends_on zlib
depends_on liblzo

fetch_source https://git.kernel.org/pub/scm/linux/kernel/git/kdave/btrfs-progs.git/snapshot/btrfs-progs-4.16.1.tar.gz 32880f5ba7eb2b7cc6aeab2ab36ee0feeaa27d0b

do_unpack
pushd_src
do_patch_inline -p0 << 'EOF'
--- configure.ac
+++ configure.ac
@@ -235,7 +235,7 @@
 # on earlier releases.
 UDEVDIR=
 if ${PKG_CONFIG} udev --atleast-version 190; then
-	UDEVDIR="$(${PKG_CONFIG} udev --variable=udevdir)"
+	UDEVDIR=
 fi
 AC_SUBST(UDEVDIR)
 
EOF
./autogen.sh
## their build system is oblivious to CPPFLAGS -- put them into CFLAGS
NEEDV1=1 CFLAGS="-g -O2 $CPPFLAGS" do_compile --disable-python --disable-zstd
popd_src
