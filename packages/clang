#!/bin/bash

requires_gcc 4.7

depends_on cmake  ## since llvm 3.9, cmake is the only way to build this
depends_on python ## needs python 2.7 to compile
depends_on zlib

CONFIGURE_FLAGS="--enable-optimized --disable-assertions --disable-libedit"

fetch_source http://llvm.org/releases/3.9.0/llvm-3.9.0.src.tar.xz da792f11a208d5b994c4fe1c8faa20f90ff0e4a3
do_unpack
rm -f "$SRCDIR"/configure
if [[ ${BASH_SOURCE##*/} == clang ]]; then
    fetch_source http://llvm.org/releases/3.9.0/cfe-3.9.0.src.tar.xz 00d49ee82451130a8e1e7b1d56cffa37b783bcb2
    intree_unpack tools/clang

    fetch_source http://llvm.org/releases/3.9.0/compiler-rt-3.9.0.src.tar.xz a306d576e84b7ee048ebb0ae5ca72e6ec9e1c549
    intree_unpack projects/compiler-rt

    fetch_source http://llvm.org/releases/3.9.0/clang-tools-extra-3.9.0.src.tar.xz 396ad1af7a8d3cff015a644e595f35553a7548c4
    intree_unpack tools/clang/tools/extra
fi

NOPARALLEL=1 \
do_compile_outside -DLLVM_OPTIMIZED_TABLEGEN=ON -DLLVM_BUILD_LLVM_DYLIB=ON
